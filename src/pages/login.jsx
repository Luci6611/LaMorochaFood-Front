import Head from 'next/head'
import { useState } from 'react';
import swal from 'sweetalert';
import Cookies from 'universal-cookie';
import { logins } from '../helpers/auth';


const login = () => {



  const [password, setPassword] = useState("");
  const [message, setMessage] = useState([]);
  const [email, setEmail] = useState(" ");

  const handleSubmit = async (e) => {
    e.preventDefault();

    const datos = await logins({ email, password });

    const cookies = new Cookies();

    if (datos?.token) {

      cookies.set("token", `${datos.token}`, { path: "/", maxAge: 3850 });
      cookies.set("nombreUsuario", `${datos.token}`, { path: "/", maxAge: 3850 });



      swal(
        `Bienvenido ${datos.usuario.nombre}`,
        "Haz Clik para continuar!",
        "success"
      ).then((active) => {
        if (active) {
          location.replace("/admi");

        }
      });
    } else {
      if (datos?.errors) {
        setMessage(datos.errors);
      } else {
        setMessage([{ msg: datos.msg }]);
      }
    }
  };
  return (


    <>
      <Head>
        <title>La Morocha - Login</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="Login de Administradores" />
        <link rel="icon" href="/favicon.ico" />
        <link rel="styles-sheets" href="../stylescomponents.css" />
      </Head>
      <div className='login-conteiner'>
        <div className="login-cuerpo">
          <p>Iniciar sesion</p>
          <form onSubmit={handleSubmit}>
            <input autoComplete="off" className='form-controls' placeholder='email' required name="email" type="email" value={email}
              onChange={(e) => setEmail(e.target.value)}
            />

            <input autoComplete="off" className='form-controls' placeholder='contraseÃ±a' required value={password} onChange={(e) => setPassword(e.target.value)} name="pasword" type="password" />


            {message.length > 0 &&
              message.map((item, index) => (
                <div
                  key={index}
                  className="login__alertas   alert alert-danger "
                  role="alert"
                >
                  {item.msg}
                </div>
              ))}
            <button className='btnf'  >
              Enviar
            </button>
          </form>

        </div></div>
    </>

  )
}

export default login